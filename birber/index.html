<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bird Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #87CEEB, #98FB98);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #2C3E50;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 15px;
            border: 2px solid #BDC3C7;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #3498DB;
        }
        
        button {
            background: linear-gradient(45deg, #3498DB, #2980B9);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .canvas-container {
            margin-top: 30px;
            border: 3px solid #ECF0F1;
            border-radius: 15px;
            overflow: hidden;
            background: #F8F9FA;
        }
        
        canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }
        
        .bird-info {
            margin-top: 20px;
            padding: 15px;
            background: #E8F6F3;
            border-radius: 10px;
            border-left: 5px solid #27AE60;
        }
        
        .loading {
            display: none;
            margin-top: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498DB;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê¶ AI Bird Generator</h1>
        <p>Describe a bird and watch it come to life!</p>
        
        <div class="input-section">
            <textarea id="birdDescription" placeholder="Describe your dream bird... (e.g., 'A majestic blue bird with golden wings and a curved beak')"></textarea>
            <button onclick="generateBird()">Generate Bird</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Creating your magical bird...</p>
        </div>
        
        <div class="canvas-container">
            <canvas id="birdCanvas" width="600" height="400"></canvas>
        </div>
        
        <div class="bird-info" id="birdInfo" style="display: none;">
            <h3>Your Bird: <span id="birdName"></span></h3>
            <p id="birdDetails"></p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('birdCanvas');
        const ctx = canvas.getContext('2d');
        
        async function generateBird() {
            const description = document.getElementById('birdDescription').value.trim();
            if (!description) {
                alert('Please describe your bird first!');
                return;
            }
            
            showLoading(true);
            
            try {
                // Fetch multiple bird images for different parts
                const birdImages = await fetchBirdImages(description);
                const birdData = await parseBirdDescription(description, birdImages);
                await createBirdCollage(birdData, birdImages);
                showBirdInfo(birdData);
            } catch (error) {
                console.log('Using fallback generation:', error);
                // Fallback to original generation if image fetch fails
                const birdData = parseBirdDescriptionFallback(description);
                drawBird(birdData);
                showBirdInfo(birdData);
            } finally {
                showLoading(false);
            }
        }
        
        async function fetchBirdImages(description) {
            // Extract bird types from description for search
            const birdTypes = [
                'cardinal', 'robin', 'eagle', 'hawk', 'owl', 'peacock', 'flamingo', 'parrot',
                'bluejay', 'crow', 'sparrow', 'finch', 'canary', 'hummingbird', 'woodpecker',
                'pelican', 'seagull', 'penguin', 'ostrich', 'turkey', 'chicken', 'duck',
                'swan', 'goose', 'crane', 'heron', 'kingfisher', 'magpie', 'raven'
            ];
            
            const words = description.toLowerCase();
            let primaryBirdType = 'bird'; // default
            
            // Find specific bird type mentioned
            for (const type of birdTypes) {
                if (words.includes(type)) {
                    primaryBirdType = type;
                    break;
                }
            }
            
            // Create a hash for consistent randomization
            let hash = 0;
            for (let i = 0; i < description.length; i++) {
                hash = ((hash << 5) - hash) + description.charCodeAt(i);
                hash = hash & hash;
            }
            
            // Select different bird types for different parts
            const shuffledTypes = [...birdTypes].sort(() => Math.sin(hash) - 0.5);
            const selectedTypes = [primaryBirdType, ...shuffledTypes.slice(0, 4)];
            
            // Try to fetch real bird images, fallback to textures if needed
            const imagePromises = selectedTypes.map(async (birdType, index) => {
                const seed = Math.abs(hash + index * 1000);
                const purpose = ['body', 'wings', 'head', 'tail', 'details'][index];
                
                // Try to get a real bird image first
                try {
                    const realBirdImage = await fetchRealBirdImage(birdType, seed);
                    return { img: realBirdImage, type: birdType, purpose, isReal: true };
                } catch (error) {
                    console.log(`Failed to load real ${birdType} image, using procedural texture`);
                    // Fallback to procedural texture
                    const img = createBirdTexture(birdType, purpose, seed, description);
                    return { img, type: birdType, purpose, isReal: false };
                }
            });
            
            // Wait for all images/textures to load
            const loadedImages = await Promise.all(imagePromises);
            
            return loadedImages;
        }
        
        async function fetchRealBirdImage(birdType, seed) {
            // Multiple sources for real bird images
            const birdImageSources = [
                // eBird API (reliable bird photography database)
                async (type, seed) => {
                    // Try Wikipedia Commons - often has public domain bird images
                    const wikiUrl = `https://commons.wikimedia.org/w/api.php?action=query&format=json&prop=imageinfo&generator=categorymembers&gcmtitle=Category:${type}&gcmtype=file&gcmlimit=50&iiprop=url&iiurlwidth=400&origin=*`;
                    
                    try {
                        const response = await fetch(wikiUrl);
                        const data = await response.json();
                        if (data.query && data.query.pages) {
                            const pages = Object.values(data.query.pages);
                            const imagePages = pages.filter(page => page.imageinfo && page.imageinfo[0].thumburl);
                            if (imagePages.length > 0) {
                                const randomPage = imagePages[seed % imagePages.length];
                                return randomPage.imageinfo[0].thumburl;
                            }
                        }
                    } catch (error) {
                        console.log('Wikipedia Commons failed:', error);
                    }
                    throw new Error('No Wikipedia images found');
                },
                
                // Flickr public bird images
                async (type, seed) => {
                    // Using Flickr's public feed for bird photos
                    const flickrUrl = `https://api.flickr.com/services/feeds/photos_public.gne?tags=${type},bird&format=json&nojsoncallback=1`;
                    
                    try {
                        const response = await fetch(flickrUrl);
                        const data = await response.json();
                        if (data.items && data.items.length > 0) {
                            const randomItem = data.items[seed % data.items.length];
                            // Get medium size image
                            return randomItem.media.m;
                        }
                    } catch (error) {
                        console.log('Flickr failed:', error);
                    }
                    throw new Error('No Flickr images found');
                },
                
                // Alternative: Use a curated list of known bird image URLs
                async (type, seed) => {
                    const birdImageUrls = getCuratedBirdImages(type);
                    if (birdImageUrls.length > 0) {
                        return birdImageUrls[seed % birdImageUrls.length];
                    }
                    throw new Error('No curated images found');
                }
            ];
            
            // Try each source until one works
            for (const sourceFunc of birdImageSources) {
                try {
                    const imageUrl = await sourceFunc(birdType, seed);
                    const img = await loadImageWithTimeout(imageUrl, 8000);
                    
                    // Verify this is actually an image
                    if (img.width > 0 && img.height > 0) {
                        return img;
                    }
                } catch (error) {
                    console.log(`Bird image source failed for ${birdType}:`, error);
                    continue;
                }
            }
            
            throw new Error(`Could not load real bird image for ${birdType}`);
        }
        
        function getCuratedBirdImages(birdType) {
            // Curated list of reliable bird image URLs (public domain/creative commons)
            const curatedImages = {
                cardinal: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/6/61/Northern_Cardinal_Broadside.jpg/400px-Northern_Cardinal_Broadside.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Cardinal-male.jpg/400px-Cardinal-male.jpg'
                ],
                robin: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Turdus-migratorius-002.jpg/400px-Turdus-migratorius-002.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/American_Robin.jpg/400px-American_Robin.jpg'
                ],
                eagle: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Bald_Eagle_Portrait.jpg/400px-Bald_Eagle_Portrait.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Bald_Eagle_Alaska.jpg/400px-Bald_Eagle_Alaska.jpg'
                ],
                owl: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Great_Horned_Owl.jpg/400px-Great_Horned_Owl.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c6/Great_Grey_Owl_1.jpg/400px-Great_Grey_Owl_1.jpg'
                ],
                peacock: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Peacock_Plumage.jpg/400px-Peacock_Plumage.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Indian_Peafowl_Plumage.jpg/400px-Indian_Peafowl_Plumage.jpg'
                ],
                flamingo: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Caribbean_Flamingo.jpg/400px-Caribbean_Flamingo.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Flamingo_Las_Bachas_Beach.jpg/400px-Flamingo_Las_Bachas_Beach.jpg'
                ],
                bluejay: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Blue_Jay_in_PP.jpg/400px-Blue_Jay_in_PP.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Blue_jay_in_PP_%28sq%29.jpg/400px-Blue_jay_in_PP_%28sq%29.jpg'
                ],
                crow: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/Corvus_brachyrhynchos_68317.jpg/400px-Corvus_brachyrhynchos_68317.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/American_Crow_-_natures_pics.jpg/400px-American_Crow_-_natures_pics.jpg'
                ],
                duck: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/Anas_platyrhynchos_male_female_quadrat.jpg/400px-Anas_platyrhynchos_male_female_quadrat.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Mallard_drake.jpg/400px-Mallard_drake.jpg'
                ],
                swan: [
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Mute_Swan_-_St_James%27s_Park%2C_London_-_Nov_2006_edit2.jpg/400px-Mute_Swan_-_St_James%27s_Park%2C_London_-_Nov_2006_edit2.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Cygnus_olor_2_%28Marek_Szczepanek%29.jpg/400px-Cygnus_olor_2_%28Marek_Szczepanek%29.jpg'
                ]
            };
            
            return curatedImages[birdType] || [];
        }
        
        function loadImageWithTimeout(url, timeout = 5000) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                const timeoutId = setTimeout(() => {
                    reject(new Error('Image load timeout'));
                }, timeout);
                
                img.onload = () => {
                    clearTimeout(timeoutId);
                    resolve(img);
                };
                
                img.onerror = () => {
                    clearTimeout(timeoutId);
                    reject(new Error('Image failed to load'));
                };
                
                img.src = url;
            });
        }
        
        function createBirdTexture(birdType, purpose, seed, description) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400;
            canvas.height = 300;
            
            // Get bird-specific colors and patterns
            const birdColors = getBirdTypeColors(birdType, description);
            const patterns = getBirdPatterns(birdType, purpose, seed);
            
            // Create base texture
            drawBaseTexture(ctx, birdColors, patterns, seed);
            
            // Add bird-specific features
            switch (purpose) {
                case 'body':
                    drawBodyTexture(ctx, birdColors, patterns, seed);
                    break;
                case 'wings':
                    drawWingTexture(ctx, birdColors, patterns, seed);
                    break;
                case 'head':
                    drawHeadTexture(ctx, birdColors, patterns, seed);
                    break;
                case 'tail':
                    drawTailTexture(ctx, birdColors, patterns, seed);
                    break;
                case 'details':
                    drawDetailTexture(ctx, birdColors, patterns, seed);
                    break;
            }
            
            // Convert to image
            const img = new Image();
            img.src = canvas.toDataURL();
            return img;
        }
        
        function getBirdTypeColors(birdType, description) {
            // Extract user-specified colors from description
            const userColors = extractUserColors(description.toLowerCase());
            
            // Default colors for different bird types
            const typeColors = {
                cardinal: { primary: '#DC143C', secondary: '#8B0000', accent: '#2F4F4F' },
                robin: { primary: '#CD853F', secondary: '#8B4513', accent: '#FF4500' },
                eagle: { primary: '#8B4513', secondary: '#654321', accent: '#FFFAF0' },
                hawk: { primary: '#696969', secondary: '#2F4F4F', accent: '#F5DEB3' },
                owl: { primary: '#8B7355', secondary: '#A0522D', accent: '#FFFAF0' },
                peacock: { primary: '#008B8B', secondary: '#4682B4', accent: '#FFD700' },
                flamingo: { primary: '#FF69B4', secondary: '#FF1493', accent: '#FFFAF0' },
                parrot: { primary: '#32CD32', secondary: '#FF4500', accent: '#FFD700' },
                bluejay: { primary: '#4169E1', secondary: '#191970', accent: '#FFFAF0' },
                crow: { primary: '#2F2F2F', secondary: '#000000', accent: '#4169E1' },
                default: { primary: '#4682B4', secondary: '#2F4F4F', accent: '#F0E68C' }
            };
            
            const colors = typeColors[birdType] || typeColors.default;
            
            // Override with user colors if specified
            if (userColors.length > 0) {
                colors.primary = userColors[0];
                if (userColors.length > 1) colors.secondary = userColors[1];
                if (userColors.length > 2) colors.accent = userColors[2];
            }
            
            return colors;
        }
        
        function getBirdPatterns(birdType, purpose, seed) {
            const patterns = {
                hasStripes: false,
                hasSpots: false,
                hasIridescence: false,
                featherDetail: 'medium',
                texture: 'smooth'
            };
            
            // Bird-specific patterns
            switch (birdType) {
                case 'peacock':
                    patterns.hasIridescence = true;
                    patterns.featherDetail = 'high';
                    patterns.hasSpots = purpose === 'tail';
                    break;
                case 'owl':
                    patterns.hasSpots = true;
                    patterns.featherDetail = 'high';
                    patterns.texture = 'fluffy';
                    break;
                case 'hawk':
                case 'eagle':
                    patterns.hasStripes = purpose === 'wings' || purpose === 'tail';
                    patterns.featherDetail = 'high';
                    break;
                case 'woodpecker':
                    patterns.hasStripes = true;
                    patterns.hasSpots = purpose === 'head';
                    break;
                case 'duck':
                case 'swan':
                    patterns.texture = 'sleek';
                    patterns.hasIridescence = purpose === 'head';
                    break;
            }
            
            return patterns;
        }
        
        function drawBaseTexture(ctx, colors, patterns, seed) {
            // Create gradient base
            const gradient = ctx.createRadialGradient(200, 150, 50, 200, 150, 200);
            gradient.addColorStop(0, colors.primary);
            gradient.addColorStop(0.7, colors.secondary);
            gradient.addColorStop(1, darkenColor(colors.secondary));
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 400, 300);
            
            // Add base noise for texture
            drawNoise(ctx, seed, 0.1);
        }
        
        function drawBodyTexture(ctx, colors, patterns, seed) {
            // Draw feather-like patterns
            ctx.globalAlpha = 0.3;
            for (let i = 0; i < 30; i++) {
                const x = (seed * i * 17) % 400;
                const y = (seed * i * 23) % 300;
                drawFeatherPattern(ctx, x, y, colors.accent, seed + i);
            }
            
            if (patterns.hasSpots) {
                drawSpotPattern(ctx, colors.accent, seed, 20);
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        function drawWingTexture(ctx, colors, patterns, seed) {
            // Draw wing feather patterns
            ctx.globalAlpha = 0.4;
            
            // Primary feathers
            for (let i = 0; i < 8; i++) {
                const x = 50 + i * 40;
                const y = 100 + Math.sin(seed + i) * 50;
                drawLongFeather(ctx, x, y, colors.secondary, seed + i);
            }
            
            // Secondary feathers
            for (let i = 0; i < 12; i++) {
                const x = 20 + i * 30;
                const y = 180 + Math.cos(seed + i) * 30;
                drawShortFeather(ctx, x, y, colors.primary, seed + i * 2);
            }
            
            if (patterns.hasStripes) {
                drawStripePattern(ctx, colors.accent, seed);
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        function drawHeadTexture(ctx, colors, patterns, seed) {
            // Smooth head texture with subtle patterns
            ctx.globalAlpha = 0.2;
            
            if (patterns.hasSpots) {
                drawSpotPattern(ctx, colors.accent, seed, 15);
            } else {
                // Fine feather detail
                for (let i = 0; i < 50; i++) {
                    const x = (seed * i * 7) % 400;
                    const y = (seed * i * 11) % 300;
                    drawTinyFeather(ctx, x, y, colors.accent, seed + i);
                }
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        function drawTailTexture(ctx, colors, patterns, seed) {
            ctx.globalAlpha = 0.5;
            
            // Long tail feathers
            for (let i = 0; i < 6; i++) {
                const x = 50 + i * 60;
                const y = 50 + Math.sin(seed + i) * 100;
                drawLongTailFeather(ctx, x, y, colors.primary, seed + i);
            }
            
            if (patterns.hasIridescence) {
                drawIridescentPattern(ctx, colors, seed);
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        function drawDetailTexture(ctx, colors, patterns, seed) {
            ctx.globalAlpha = 0.15;
            
            // Overlay texture details
            drawNoise(ctx, seed, 0.05);
            
            // Fine detail patterns
            for (let i = 0; i < 100; i++) {
                const x = (seed * i * 3) % 400;
                const y = (seed * i * 5) % 300;
                const size = 1 + (seed * i) % 3;
                
                ctx.fillStyle = colors.accent;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        function drawFeatherPattern(ctx, x, y, color, seed) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.ellipse(x, y, 8 + (seed % 5), 3 + (seed % 3), (seed % 100) / 50, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawLongFeather(ctx, x, y, color, seed) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.quadraticCurveTo(x + 10, y - 20, x + 5, y - 40);
            ctx.stroke();
        }
        
        function drawShortFeather(ctx, x, y, color, seed) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.ellipse(x, y, 6, 2, (seed % 100) / 100 * Math.PI, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawTinyFeather(ctx, x, y, color, seed) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, 1 + (seed % 2), 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawLongTailFeather(ctx, x, y, color, seed) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.quadraticCurveTo(x + 20, y + 60, x + 10, y + 120);
            ctx.stroke();
        }
        
        function drawSpotPattern(ctx, color, seed, count) {
            ctx.fillStyle = color;
            for (let i = 0; i < count; i++) {
                const x = (seed * i * 19) % 400;
                const y = (seed * i * 31) % 300;
                const size = 3 + (seed * i) % 8;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function drawStripePattern(ctx, color, seed) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            for (let i = 0; i < 8; i++) {
                const y = 50 + i * 25;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(400, y + Math.sin(seed + i) * 20);
                ctx.stroke();
            }
        }
        
        function drawIridescentPattern(ctx, colors, seed) {
            const gradient = ctx.createRadialGradient(200, 150, 0, 200, 150, 100);
            gradient.addColorStop(0, colors.accent);
            gradient.addColorStop(0.5, colors.primary);
            gradient.addColorStop(1, colors.secondary);
            
            ctx.fillStyle = gradient;
            ctx.globalAlpha = 0.3;
            ctx.fillRect(0, 0, 400, 300);
        }
        
        function drawNoise(ctx, seed, intensity) {
            const imageData = ctx.getImageData(0, 0, 400, 300);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const noise = (Math.sin(seed + i / 1000) * 255 * intensity);
                data[i] += noise;     // red
                data[i + 1] += noise; // green
                data[i + 2] += noise; // blue
            }
            
            ctx.putImageData(imageData, 0, 0);
        }
        
        function generateRandomShape(hash, description) {
            // Use text hash to create consistent random values
            const rng = (seed) => Math.abs(Math.sin(seed * 12.9898 + description.length * 4.1414) * 43758.5453) % 1;
            
            return {
                // Body proportions (0.5 to 2.0 multipliers)
                bodyWidth: 0.5 + rng(hash * 1) * 1.5,
                bodyHeight: 0.5 + rng(hash * 2) * 1.5,
                bodyRoundness: rng(hash * 3), // 0 = oval, 1 = circle
                
                // Head proportions
                headSize: 0.6 + rng(hash * 4) * 0.8, // 0.6 to 1.4
                headPosition: -0.3 + rng(hash * 5) * 0.6, // neck length variation
                
                // Wing characteristics
                wingSpan: 0.7 + rng(hash * 6) * 0.8, // 0.7 to 1.5
                wingAngle: -0.5 + rng(hash * 7) * 1.0, // wing spread
                wingShape: rng(hash * 8), // 0 = narrow, 1 = broad
                
                // Tail characteristics  
                tailLength: 0.5 + rng(hash * 9) * 1.5, // 0.5 to 2.0
                tailSpread: rng(hash * 10), // 0 = narrow, 1 = fan-like
                tailCurve: -0.5 + rng(hash * 11) * 1.0, // upward/downward curve
                
                // Leg characteristics
                legLength: 0.6 + rng(hash * 12) * 0.8, // 0.6 to 1.4
                legPosition: -0.2 + rng(hash * 13) * 0.4, // forward/backward stance
                
                // Overall posture
                posture: rng(hash * 14), // 0 = upright, 1 = horizontal
                asymmetry: rng(hash * 15) * 0.3, // slight asymmetric variations
            };
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        async function parseBirdDescription(description, birdImages) {
            // Analyze the primary image to extract colors and features
            const primaryImage = birdImages[0]?.img;
            const imageAnalysis = primaryImage ? await analyzeImage(primaryImage) : null;
            
            const words = description.toLowerCase();
            
            // Create a hash from the description for consistent randomization
            let hash = 0;
            for (let i = 0; i < description.length; i++) {
                const char = description.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            // Use colors from the actual bird image
            let primaryColor = imageAnalysis.dominantColor;
            let secondaryColor = imageAnalysis.accentColor;
            
            // Override with user-specified colors if mentioned
            const userColors = extractUserColors(words);
            if (userColors.length > 0) {
                primaryColor = userColors[0];
                if (userColors.length > 1) {
                    secondaryColor = userColors[1];
                }
            }
            
            const size = words.includes('large') || words.includes('big') || words.includes('huge') || words.includes('giant') ? 'large' :
                        words.includes('small') || words.includes('tiny') || words.includes('little') || words.includes('mini') ? 'small' : 'medium';
            
            const beakType = words.includes('curved') || words.includes('hooked') || words.includes('eagle') ? 'curved' :
                            words.includes('long') || words.includes('pointed') || words.includes('sharp') ? 'long' : 'normal';
            
            const hasFeatherDetails = words.includes('feather') || words.includes('plume') || words.includes('crest') || 
                                    words.includes('fluffy') || words.includes('ruffled') || imageAnalysis.hasComplexFeathers;
            const isMajestic = words.includes('majestic') || words.includes('elegant') || words.includes('royal') || 
                              words.includes('magnificent') || words.includes('beautiful');
            
            const hasLongTail = words.includes('peacock') || words.includes('long tail') || words.includes('flowing') || imageAnalysis.hasLongTail;
            const isRound = words.includes('round') || words.includes('chubby') || words.includes('fat') || words.includes('owl') || imageAnalysis.roundBody;
            const hasSpots = words.includes('spot') || words.includes('dot') || words.includes('speckle') || imageAnalysis.hasSpots;
            const hasStripes = words.includes('stripe') || words.includes('band') || words.includes('zebra') || imageAnalysis.hasStripes;
            
            // Generate randomized shape profile using text as seed
            const shapeProfile = generateRandomShape(hash, description);
            
            const birdNames = ['Skyweaver', 'Cloudwing', 'Featherbeam', 'Wingwhisper', 'Airglow', 'Stormchaser', 
                              'Sunfeather', 'Moonwing', 'Starwhisper', 'Dreamsoar', 'Mistral', 'Aurora'];
            const birdName = birdNames[Math.abs(hash * 7) % birdNames.length];
            
            return {
                primaryColor,
                secondaryColor,
                size,
                beakType,
                hasFeatherDetails,
                isMajestic,
                hasLongTail,
                isRound,
                hasSpots,
                hasStripes,
                name: birdName,
                description,
                hash,
                referenceImage: imageAnalysis,
                birdImages,
                shapeProfile
            };
        }
        
        async function createBirdCollage(birdData, birdImages) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw gradient background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Define bird composition layout with randomized shape
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const sizeMultiplier = birdData.size === 'large' ? 1.4 : birdData.size === 'small' ? 0.6 : 1;
            const shape = birdData.shapeProfile;
            
            // Apply posture adjustment
            const postureOffset = (shape.posture - 0.5) * 40 * sizeMultiplier;
            const bodyY = centerY + postureOffset;
            
            // Extract and place different bird parts with shape variations
            for (const imageData of birdImages) {
                const { img, purpose } = imageData;
                
                switch (purpose) {
                    case 'body':
                        const bodyWidth = 100 * sizeMultiplier * shape.bodyWidth;
                        const bodyHeight = 80 * sizeMultiplier * shape.bodyHeight;
                        const bodyStyle = shape.bodyRoundness > 0.6 ? 'circular' : 'center';
                        
                        await drawImagePart(img, centerX - bodyWidth/2, bodyY - bodyHeight/2, 
                                          bodyWidth, bodyHeight, bodyStyle);
                        break;
                        
                    case 'wings':
                        const wingSpan = 60 * sizeMultiplier * shape.wingSpan;
                        const wingHeight = 50 * sizeMultiplier * (shape.wingShape * 0.5 + 0.5);
                        const wingAngle = shape.wingAngle;
                        const wingY = bodyY - 20 * sizeMultiplier;
                        
                        // Left wing with shape variations
                        await drawImagePart(img, centerX - wingSpan - 20 * sizeMultiplier, wingY, 
                                          wingSpan, wingHeight, 'wings', -0.3 + wingAngle);
                        // Right wing with asymmetry
                        await drawImagePart(img, centerX + 20 * sizeMultiplier, wingY + shape.asymmetry * 10, 
                                          wingSpan, wingHeight, 'wings', 0.3 + wingAngle);
                        break;
                        
                    case 'head':
                        const headSize = 50 * sizeMultiplier * shape.headSize;
                        const headY = bodyY - 50 * sizeMultiplier + shape.headPosition * 30 * sizeMultiplier;
                        
                        await drawImagePart(img, centerX - headSize/2, headY - headSize/2, 
                                          headSize, headSize, 'circular');
                        break;
                        
                    case 'tail':
                        const tailLength = 80 * sizeMultiplier * shape.tailLength;
                        const tailHeight = shape.tailSpread > 0.5 ? 60 * sizeMultiplier : 30 * sizeMultiplier;
                        const tailY = bodyY + shape.tailCurve * 20 * sizeMultiplier;
                        const tailStyle = shape.tailSpread > 0.5 ? 'fan' : 'elongated';
                        
                        await drawImagePart(img, centerX - tailLength - 40 * sizeMultiplier, tailY, 
                                          tailLength, tailHeight, tailStyle);
                        break;
                        
                    case 'details':
                        // Add texture details on top with shape awareness
                        ctx.globalAlpha = 0.3;
                        const detailWidth = 80 * sizeMultiplier * shape.bodyWidth;
                        const detailHeight = 60 * sizeMultiplier * shape.bodyHeight;
                        
                        await drawImagePart(img, centerX - detailWidth/2, bodyY - detailHeight/2, 
                                          detailWidth, detailHeight, 'overlay');
                        ctx.globalAlpha = 1.0;
                        break;
                }
            }
            
            // Add simple drawn elements for beak and legs with shape variations
            const beakY = bodyY - 30 * sizeMultiplier + shape.headPosition * 30 * sizeMultiplier;
            const legY = bodyY + 30 * sizeMultiplier * shape.bodyHeight;
            const legOffset = shape.legPosition * 20 * sizeMultiplier;
            
            drawSimpleBeak(centerX + 25 * sizeMultiplier * shape.headSize, beakY, birdData, sizeMultiplier);
            drawSimpleLegs(centerX + legOffset, legY, sizeMultiplier * shape.legLength);
        }
        
        async function drawImagePart(img, x, y, width, height, style = 'rectangle', rotation = 0) {
            ctx.save();
            
            // Apply rotation if specified
            if (rotation !== 0) {
                ctx.translate(x + width/2, y + height/2);
                ctx.rotate(rotation);
                ctx.translate(-width/2, -height/2);
                x = 0;
                y = 0;
            }
            
            // Create clipping path based on style
            ctx.beginPath();
            
            switch (style) {
                case 'circular':
                    ctx.arc(x + width/2, y + height/2, width/2, 0, Math.PI * 2);
                    break;
                case 'wings':
                    ctx.ellipse(x + width/2, y + height/2, width/2, height/2, 0, 0, Math.PI * 2);
                    break;
                case 'elongated':
                    ctx.ellipse(x + width/2, y + height/2, width/2, height/4, 0, 0, Math.PI * 2);
                    break;
                case 'feathers':
                    // Irregular feather-like shape
                    ctx.moveTo(x, y + height/2);
                    ctx.quadraticCurveTo(x + width/3, y, x + width, y + height/3);
                    ctx.quadraticCurveTo(x + width*2/3, y + height, x, y + height/2);
                    break;
                case 'fan':
                    // Fan-like tail shape
                    ctx.moveTo(x + width, y + height/2);
                    ctx.quadraticCurveTo(x + width/2, y, x, y + height/4);
                    ctx.quadraticCurveTo(x + width/3, y + height/2, x, y + height*3/4);
                    ctx.quadraticCurveTo(x + width/2, y + height, x + width, y + height/2);
                    break;
                case 'overlay':
                    ctx.rect(x, y, width, height);
                    break;
                default: // rectangle or center
                    if (style === 'center') {
                        // Oval body shape
                        ctx.ellipse(x + width/2, y + height/2, width/2, height/2, 0, 0, Math.PI * 2);
                    } else {
                        ctx.rect(x, y, width, height);
                    }
            }
            
            ctx.clip();
            
            // Draw the image part
            ctx.drawImage(img, x, y, width, height);
            
            ctx.restore();
        }
        
        function drawSimpleBeak(x, y, birdData, size) {
            ctx.fillStyle = '#FFA500';
            ctx.beginPath();
            
            if (birdData.beakType === 'curved') {
                ctx.arc(x, y, 12 * size, 0, Math.PI, false);
            } else if (birdData.beakType === 'long') {
                ctx.moveTo(x, y - 4 * size);
                ctx.lineTo(x + 20 * size, y);
                ctx.lineTo(x, y + 4 * size);
            } else {
                ctx.moveTo(x, y - 6 * size);
                ctx.lineTo(x + 12 * size, y);
                ctx.lineTo(x, y + 6 * size);
            }
            
            ctx.closePath();
            ctx.fill();
            
            ctx.strokeStyle = '#FF8C00';
            ctx.lineWidth = 1;
            ctx.stroke();
        }
        
        function drawSimpleLegs(x, y, size) {
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 2 * size;
            
            ctx.beginPath();
            ctx.moveTo(x - 8 * size, y);
            ctx.lineTo(x - 8 * size, y + 15 * size);
            ctx.moveTo(x + 8 * size, y);
            ctx.lineTo(x + 8 * size, y + 15 * size);
            ctx.stroke();
            
            // Simple feet
            ctx.beginPath();
            ctx.moveTo(x - 8 * size, y + 15 * size);
            ctx.lineTo(x - 12 * size, y + 18 * size);
            ctx.moveTo(x - 8 * size, y + 15 * size);
            ctx.lineTo(x - 4 * size, y + 18 * size);
            
            ctx.moveTo(x + 8 * size, y + 15 * size);
            ctx.lineTo(x + 12 * size, y + 18 * size);
            ctx.moveTo(x + 8 * size, y + 15 * size);
            ctx.lineTo(x + 4 * size, y + 18 * size);
            ctx.stroke();
        }
        
        async function analyzeImage(img) {
            // Create a temporary canvas to analyze the image
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = img.width;
            tempCanvas.height = img.height;
            
            // Draw the image
            tempCtx.drawImage(img, 0, 0);
            
            // Get image data
            const imageData = tempCtx.getImageData(0, 0, img.width, img.height);
            const data = imageData.data;
            
            // Analyze colors
            const colorFrequency = {};
            const sampleRate = 10; // Sample every 10th pixel for performance
            
            for (let i = 0; i < data.length; i += 4 * sampleRate) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const alpha = data[i + 3];
                
                if (alpha > 128) { // Only count non-transparent pixels
                    const colorKey = `${Math.floor(r/32)*32},${Math.floor(g/32)*32},${Math.floor(b/32)*32}`;
                    colorFrequency[colorKey] = (colorFrequency[colorKey] || 0) + 1;
                }
            }
            
            // Find dominant colors
            const sortedColors = Object.entries(colorFrequency)
                .sort(([,a], [,b]) => b - a)
                .map(([color]) => color.split(',').map(Number));
            
            const dominantColor = sortedColors[0] ? `rgb(${sortedColors[0].join(',')})` : '#3498DB';
            const accentColor = sortedColors[1] ? `rgb(${sortedColors[1].join(',')})` : '#2980B9';
            
            // Simple feature detection based on color patterns
            const hasComplexFeathers = sortedColors.length > 5;
            const hasLongTail = img.height > img.width * 1.2;
            const roundBody = img.width > img.height * 1.1;
            
            // Detect patterns by analyzing color variation
            const colorVariance = calculateColorVariance(data);
            const hasSpots = colorVariance.spots > 0.3;
            const hasStripes = colorVariance.stripes > 0.4;
            
            return {
                dominantColor,
                accentColor,
                hasComplexFeathers,
                hasLongTail,
                roundBody,
                hasSpots,
                hasStripes
            };
        }
        
        function calculateColorVariance(data) {
            // Simple pattern detection
            let spotVariance = 0;
            let stripeVariance = 0;
            const sampleSize = Math.min(data.length / 4, 1000);
            
            for (let i = 0; i < sampleSize * 4; i += 40) {
                const r1 = data[i];
                const r2 = data[i + 20] || r1;
                const r3 = data[i + 40] || r1;
                
                // Spot detection: random color changes
                spotVariance += Math.abs(r1 - r2) / 255;
                
                // Stripe detection: regular patterns
                if (Math.abs(r1 - r3) < 20 && Math.abs(r1 - r2) > 30) {
                    stripeVariance += 0.1;
                }
            }
            
            return {
                spots: spotVariance / sampleSize,
                stripes: stripeVariance / sampleSize * 10
            };
        }
        
        function extractUserColors(words) {
            const colors = {
                red: '#E74C3C', blue: '#3498DB', green: '#27AE60', yellow: '#F1C40F',
                orange: '#E67E22', purple: '#9B59B6', pink: '#E91E63', black: '#2C3E50',
                white: '#ECF0F1', brown: '#8D6E63', gold: '#FFD700', silver: '#C0C0C0',
                crimson: '#DC143C', azure: '#87CEEB', emerald: '#50C878', violet: '#8A2BE2',
                turquoise: '#40E0D0', coral: '#FF7F50', indigo: '#4B0082', maroon: '#800000',
                teal: '#008080', lime: '#00FF00', magenta: '#FF00FF', cyan: '#00FFFF'
            };
            
            const foundColors = [];
            for (const [colorName, colorValue] of Object.entries(colors)) {
                if (words.includes(colorName)) {
                    foundColors.push(colorValue);
                }
            }
            return foundColors;
        }
        
        function parseBirdDescriptionFallback(description) {
            const words = description.toLowerCase();
            
            const colors = {
                red: '#E74C3C', blue: '#3498DB', green: '#27AE60', yellow: '#F1C40F',
                orange: '#E67E22', purple: '#9B59B6', pink: '#E91E63', black: '#2C3E50',
                white: '#ECF0F1', brown: '#8D6E63', gold: '#FFD700', silver: '#C0C0C0',
                crimson: '#DC143C', azure: '#87CEEB', emerald: '#50C878', violet: '#8A2BE2',
                turquoise: '#40E0D0', coral: '#FF7F50', indigo: '#4B0082', maroon: '#800000',
                teal: '#008080', lime: '#00FF00', magenta: '#FF00FF', cyan: '#00FFFF'
            };
            
            // Create a hash from the description for consistent randomization
            let hash = 0;
            for (let i = 0; i < description.length; i++) {
                const char = description.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            // Find colors mentioned in description
            const foundColors = [];
            for (const [colorName, colorValue] of Object.entries(colors)) {
                if (words.includes(colorName)) {
                    foundColors.push(colorValue);
                }
            }
            
            let primaryColor, secondaryColor;
            
            if (foundColors.length >= 2) {
                primaryColor = foundColors[0];
                secondaryColor = foundColors[1];
            } else if (foundColors.length === 1) {
                primaryColor = foundColors[0];
                // Generate complementary color
                secondaryColor = generateComplementaryColor(primaryColor);
            } else {
                // Use hash to pick consistent random colors
                const colorValues = Object.values(colors);
                primaryColor = colorValues[Math.abs(hash) % colorValues.length];
                secondaryColor = colorValues[Math.abs(hash * 3) % colorValues.length];
            }
            
            const size = words.includes('large') || words.includes('big') || words.includes('huge') || words.includes('giant') ? 'large' :
                        words.includes('small') || words.includes('tiny') || words.includes('little') || words.includes('mini') ? 'small' : 'medium';
            
            const beakType = words.includes('curved') || words.includes('hooked') || words.includes('eagle') ? 'curved' :
                            words.includes('long') || words.includes('pointed') || words.includes('sharp') ? 'long' : 'normal';
            
            const hasFeatherDetails = words.includes('feather') || words.includes('plume') || words.includes('crest') || 
                                    words.includes('fluffy') || words.includes('ruffled');
            const isMajestic = words.includes('majestic') || words.includes('elegant') || words.includes('royal') || 
                              words.includes('magnificent') || words.includes('beautiful');
            
            // More varied characteristics
            const hasLongTail = words.includes('peacock') || words.includes('long tail') || words.includes('flowing');
            const isRound = words.includes('round') || words.includes('chubby') || words.includes('fat') || words.includes('owl');
            const hasSpots = words.includes('spot') || words.includes('dot') || words.includes('speckle');
            const hasStripes = words.includes('stripe') || words.includes('band') || words.includes('zebra');
            
            const birdNames = ['Skyweaver', 'Cloudwing', 'Featherbeam', 'Wingwhisper', 'Airglow', 'Stormchaser', 
                              'Sunfeather', 'Moonwing', 'Starwhisper', 'Dreamsoar', 'Mistral', 'Aurora'];
            const birdName = birdNames[Math.abs(hash * 7) % birdNames.length];
            
            return {
                primaryColor,
                secondaryColor,
                size,
                beakType,
                hasFeatherDetails,
                isMajestic,
                hasLongTail,
                isRound,
                hasSpots,
                hasStripes,
                name: birdName,
                description,
                hash
            };
        }
        
        function generateComplementaryColor(hexColor) {
            const hex = hexColor.replace('#', '');
            const r = 255 - parseInt(hex.substr(0, 2), 16);
            const g = 255 - parseInt(hex.substr(2, 2), 16);
            const b = 255 - parseInt(hex.substr(4, 2), 16);
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }
        
        function drawBird(birdData) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawBackground();
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            const sizeMultiplier = birdData.size === 'large' ? 1.4 : birdData.size === 'small' ? 0.6 : 1;
            
            // Adjust body shape based on characteristics
            if (birdData.isRound) {
                drawRoundBody(centerX, centerY, birdData, sizeMultiplier);
            } else {
                drawBody(centerX, centerY, birdData, sizeMultiplier);
            }
            
            drawWings(centerX, centerY, birdData, sizeMultiplier);
            drawHead(centerX, centerY - 40 * sizeMultiplier, birdData, sizeMultiplier);
            drawBeak(centerX + 35 * sizeMultiplier, centerY - 40 * sizeMultiplier, birdData, sizeMultiplier);
            drawEye(centerX + 15 * sizeMultiplier, centerY - 45 * sizeMultiplier, sizeMultiplier);
            
            if (birdData.hasLongTail) {
                drawLongTail(centerX - 60 * sizeMultiplier, centerY, birdData, sizeMultiplier);
            } else {
                drawTail(centerX - 60 * sizeMultiplier, centerY, birdData, sizeMultiplier);
            }
            
            drawLegs(centerX, centerY + 40 * sizeMultiplier, sizeMultiplier);
            
            if (birdData.hasFeatherDetails) {
                drawFeatherDetails(centerX, centerY, birdData, sizeMultiplier);
            }
            
            if (birdData.hasSpots) {
                drawSpots(centerX, centerY, birdData, sizeMultiplier);
            }
            
            if (birdData.hasStripes) {
                drawStripes(centerX, centerY, birdData, sizeMultiplier);
            }
        }
        
        function drawBackground() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawClouds();
        }
        
        function drawClouds() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            for (let i = 0; i < 3; i++) {
                const x = (i + 1) * 150;
                const y = 50 + i * 20;
                drawCloud(x, y, 30);
            }
        }
        
        function drawCloud(x, y, radius) {
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.arc(x + 25, y, radius * 0.8, 0, Math.PI * 2);
            ctx.arc(x + 50, y, radius, 0, Math.PI * 2);
            ctx.arc(x + 25, y - 20, radius * 0.6, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawBody(x, y, birdData, size) {
            ctx.fillStyle = birdData.primaryColor;
            ctx.beginPath();
            ctx.ellipse(x, y, 50 * size, 35 * size, 0, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = darkenColor(birdData.primaryColor);
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        function drawWings(x, y, birdData, size) {
            ctx.fillStyle = birdData.secondaryColor;
            
            ctx.beginPath();
            ctx.ellipse(x - 20 * size, y - 10 * size, 40 * size, 25 * size, -0.3, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.ellipse(x + 20 * size, y - 10 * size, 40 * size, 25 * size, 0.3, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = darkenColor(birdData.secondaryColor);
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }
        
        function drawHead(x, y, birdData, size) {
            ctx.fillStyle = birdData.primaryColor;
            ctx.beginPath();
            ctx.arc(x, y, 25 * size, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = darkenColor(birdData.primaryColor);
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        function drawBeak(x, y, birdData, size) {
            ctx.fillStyle = '#FFA500';
            ctx.beginPath();
            
            if (birdData.beakType === 'curved') {
                ctx.arc(x, y, 15 * size, 0, Math.PI, false);
            } else if (birdData.beakType === 'long') {
                ctx.moveTo(x, y - 5 * size);
                ctx.lineTo(x + 25 * size, y);
                ctx.lineTo(x, y + 5 * size);
            } else {
                ctx.moveTo(x, y - 8 * size);
                ctx.lineTo(x + 15 * size, y);
                ctx.lineTo(x, y + 8 * size);
            }
            
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = '#FF8C00';
            ctx.lineWidth = 1;
            ctx.stroke();
        }
        
        function drawEye(x, y, size) {
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(x, y, 8 * size, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(x, y, 5 * size, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(x + 2 * size, y - 2 * size, 2 * size, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawTail(x, y, birdData, size) {
            ctx.fillStyle = birdData.secondaryColor;
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.ellipse(x - i * 15 * size, y + i * 10 * size, 30 * size, 8 * size, -0.5 - i * 0.2, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function drawLegs(x, y, size) {
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 3 * size;
            
            ctx.beginPath();
            ctx.moveTo(x - 10 * size, y);
            ctx.lineTo(x - 10 * size, y + 20 * size);
            ctx.moveTo(x + 10 * size, y);
            ctx.lineTo(x + 10 * size, y + 20 * size);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(x - 10 * size, y + 20 * size);
            ctx.lineTo(x - 15 * size, y + 25 * size);
            ctx.moveTo(x - 10 * size, y + 20 * size);
            ctx.lineTo(x - 5 * size, y + 25 * size);
            ctx.moveTo(x - 10 * size, y + 20 * size);
            ctx.lineTo(x - 10 * size, y + 25 * size);
            
            ctx.moveTo(x + 10 * size, y + 20 * size);
            ctx.lineTo(x + 15 * size, y + 25 * size);
            ctx.moveTo(x + 10 * size, y + 20 * size);
            ctx.lineTo(x + 5 * size, y + 25 * size);
            ctx.moveTo(x + 10 * size, y + 20 * size);
            ctx.lineTo(x + 10 * size, y + 25 * size);
            ctx.stroke();
        }
        
        function drawRoundBody(x, y, birdData, size) {
            ctx.fillStyle = birdData.primaryColor;
            ctx.beginPath();
            ctx.arc(x, y, 45 * size, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = darkenColor(birdData.primaryColor);
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        function drawLongTail(x, y, birdData, size) {
            ctx.fillStyle = birdData.secondaryColor;
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.ellipse(x - i * 20 * size, y + i * 8 * size, 40 * size, 6 * size, -0.3 - i * 0.15, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = lightenColor(birdData.secondaryColor);
                ctx.beginPath();
                ctx.ellipse(x - i * 20 * size, y + i * 8 * size, 35 * size, 4 * size, -0.3 - i * 0.15, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = birdData.secondaryColor;
            }
        }
        
        function drawSpots(x, y, birdData, size) {
            ctx.fillStyle = darkenColor(birdData.primaryColor);
            const numSpots = 8 + Math.floor(Math.abs(birdData.hash) % 5);
            
            for (let i = 0; i < numSpots; i++) {
                const spotX = x + (Math.sin(birdData.hash * i) * 40 * size);
                const spotY = y + (Math.cos(birdData.hash * i * 1.5) * 25 * size);
                const spotSize = 2 + (Math.abs(birdData.hash * i) % 4) * size;
                
                ctx.beginPath();
                ctx.arc(spotX, spotY, spotSize, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function drawStripes(x, y, birdData, size) {
            ctx.strokeStyle = darkenColor(birdData.primaryColor);
            ctx.lineWidth = 3 * size;
            
            for (let i = 0; i < 4; i++) {
                const stripeY = y - 20 * size + i * 10 * size;
                ctx.beginPath();
                ctx.moveTo(x - 40 * size, stripeY);
                ctx.lineTo(x + 40 * size, stripeY);
                ctx.stroke();
            }
        }
        
        function drawFeatherDetails(x, y, birdData, size) {
            ctx.fillStyle = lightenColor(birdData.primaryColor);
            const numFeathers = 5 + Math.floor(Math.abs(birdData.hash) % 3);
            
            for (let i = 0; i < numFeathers; i++) {
                const featherX = x - 30 * size + i * (60 * size / numFeathers);
                const featherY = y - 20 * size + (Math.sin(birdData.hash * i) * 10 * size);
                const rotation = Math.sin(birdData.hash * i * 2) * 0.5;
                
                ctx.beginPath();
                ctx.ellipse(featherX, featherY, 3 * size, 12 * size, rotation, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function darkenColor(color) {
            const hex = color.replace('#', '');
            const r = Math.max(0, parseInt(hex.substr(0, 2), 16) - 30);
            const g = Math.max(0, parseInt(hex.substr(2, 2), 16) - 30);
            const b = Math.max(0, parseInt(hex.substr(4, 2), 16) - 30);
            return `rgb(${r}, ${g}, ${b})`;
        }
        
        function lightenColor(color) {
            const hex = color.replace('#', '');
            const r = Math.min(255, parseInt(hex.substr(0, 2), 16) + 40);
            const g = Math.min(255, parseInt(hex.substr(2, 2), 16) + 40);
            const b = Math.min(255, parseInt(hex.substr(4, 2), 16) + 40);
            return `rgb(${r}, ${g}, ${b})`;
        }
        
        function showBirdInfo(birdData) {
            document.getElementById('birdName').textContent = birdData.name;
            
            let details = `This magnificent ${birdData.size} bird features rich plumage with ${birdData.hasFeatherDetails ? 'intricate feather patterns' : 'smooth feathers'}. `;
            
            // Check how many real images were used
            const realImageCount = birdData.birdImages ? birdData.birdImages.filter(img => img.isReal).length : 0;
            const totalImages = birdData.birdImages ? birdData.birdImages.length : 0;
            
            if (realImageCount > 0) {
                details += `Created using ${realImageCount}/${totalImages} real bird photographs, it `;
            } else {
                details += `Created with procedural bird textures, it `;
            }
            
            details += `has a ${birdData.beakType} beak`;
            
            if (birdData.hasLongTail) details += ` and a flowing tail`;
            if (birdData.hasSpots) details += ` with distinctive spots`;
            if (birdData.hasStripes) details += ` and elegant stripes`;
            if (birdData.isRound) details += ` and a round, compact body`;
            
            details += '. ';
            details += birdData.isMajestic ? 'A truly majestic creature!' : 'A beautiful bird!';
            
            if (realImageCount > 0) {
                details += ` Collaged from authentic bird photography${realImageCount < totalImages ? ' with procedural enhancements' : ''}.`;
            } else {
                details += ' Generated with realistic bird-like textures and patterns.';
            }
            
            document.getElementById('birdDetails').textContent = details;
            document.getElementById('birdInfo').style.display = 'block';
        }
        
        drawBird({
            primaryColor: '#3498DB',
            secondaryColor: '#2980B9',
            size: 'medium',
            beakType: 'normal',
            hasFeatherDetails: false,
            isMajestic: false,
            name: 'Example Bird',
            description: 'Welcome bird'
        });
    </script>
</body>
</html>